<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Clon Twitter - Home</title>
    <link
      rel="shortcut icon"
      href="/assets/img/new-twitter-logo-vector-512.png"
      type="image/x-icon"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/index.css" />
  </head>

  <body style="background-color: rgb(21, 32, 43)" class="home text-light">
    <div class="container">
      <div class="row justify-content-center">
        <div
          class="col p-0"
          style="
            border-left: solid 1px rgb(107, 125, 140);
            border-right: solid 1px rgb(107, 125, 140);
          "
        >
          <div>
            <div class="d-flex align-items-center px-4 py-4">
              <a
                href="/"
                class="me-3 fs-4 text-decoration-none"
                style="color: rgb(29, 161, 242)"
                ><i class="fas fa-arrow-left"></i
              ></a>
              <div>
                <h3 class="fs-5 m-0">
                  <%= user.firstName %> <%= user.lastName %>
                </h3>
                <small style="color: rgb(107, 125, 140)">
                  <%= user.tweets.length %> tweets
                </small>
              </div>
            </div>
            <div>
              <img
                src="https://images.unsplash.com/photo-1588392382834-a891154bca4d?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=755&q=80"
                alt=""
                style="max-height: 300px; width: 100%"
              />
            </div>
            <div class="d-flex justify-content-between align-items-center px-4">
              <% if (user.profilePicture) {%>
              <img
                style="
                  margin-top: -80px;
                  width: 150px !important;
                  height: 150px !important;
                  border-radius: 50%;
                "
                src="<%= user.profilePicture %>"
                alt=""
              />
              <% } else { %>
              <img
                style="
                  margin-top: -80px;
                  width: 150px !important;
                  height: 150px !important;
                  border-radius: 50%;
                "
                src="/assets/img/pollito.png"
                alt=""
              />
              <% } %> <% if(loggedInUser.userName===user.userName) { %>
              <button
                data-bs-toggle="modal"
                data-bs-target="#editProfileModal"
                class="rounded-pill px-3 py-2 fw-bold"
                style="
                  color: rgb(29, 161, 242);
                  background-color: transparent;
                  border: solid 1px rgb(29, 161, 242);
                "
              >
                Editar perfil
              </button>
              <% } else { %> <% if (loggedInUser.following.some((followed)=>
              followed._id.equals(user._id))) { %>
              <a
                class="seguir__a"
                href="/usuario/seguir/<%= user.id %> "
                title="Seguir"
                >Siguiendo</a
              >
              <% } else { %>
              <a
                class="seguir__a"
                href="/usuario/seguir/<%= user.id %> "
                title="Seguir"
                >Seguir</a
              >
              <% }} %>
            </div>
            <div class="px-4 mt-4">
              <h4><%= user.firstName %> <%= user.lastName %></h4>
              <p>@<%= user.userName %></p>
            </div>
            <div class="px-4"><%= user.description %></div>
            <div style="color: rgb(107, 125, 140)" class="mt-3 px-4">
              Se unió <%= user.createdAt %>
            </div>
            <div class="d-flex align-items-center mt-3 pb-2 px-4">
              <span class="fw-bold text-light me-2">
                <%= user.following.length %>
              </span>
              <button
                type="button"
                class="btn"
                data-bs-toggle="modal"
                data-bs-target="#exampleModal"
                style="color: rgb(107, 125, 140)"
              >
                siguiendo
              </button>

              <span class="fw-bold text-light me-2">
                <%= user.followers.length %>
              </span>
              <button
                type="button"
                class="btn"
                data-bs-toggle="modal"
                data-bs-target="#exampleModal"
                style="color: rgb(107, 125, 140)"
              >
                seguidores
              </button>
            </div>
            <div
              class="px-4 mt-4 pb-2"
              style="border-bottom: solid 1px rgb(107, 125, 140)"
            >
              <p
                class="fw-bold pb-2 d-inline-block"
                style="
                  border-bottom: solid 4px rgb(29, 161, 242);
                  color: rgb(29, 161, 242);
                "
              >
                Tweets
              </p>
            </div>
          </div>
          <!-- Tweets -->
          <!-- Poner lo de Eduardo -->
          <% user.tweets.forEach((tweet)=> { %>
          <section class="centro__tweet pt-4">
            <div
              class="centro__col d-flex justify-content-center align-items-center"
              style="overflow: hidden"
            >
              <% if (user.profilePicture) {%>
              <img
                src="<%= user.profilePicture %>"
                alt="User"
                style="
                  width: 100px !important;
                  height: 100px !important;
                  border-radius: 50%;
                "
              />
              <% } else { %>
              <img
                src="/assets/img/pollito.png"
                alt="User"
                style="
                  width: 100px !important;
                  height: 100px !important;
                  border-radius: 50%;
                "
              />
              <% } %>
            </div>
            <div class="centro__col">
              <div class="centro__row centro__row--user">
                <h3 class="centro__h3"><%= user.firstName %></h3>
                <h4 class="centro__h4">@<%= user.userName %></h4>
                <span class="centro__tiempo"> <%= tweet.createdAt %> </span>
              </div>
              <div class="centro__row">
                <p class="centro__text"><%= tweet.text %></p>
              </div>

              <ul class="centro__ul">
                <li class="centro__li">
                  <span class="centro__numero">
                    <a href="/eliminar/<%= tweet._id %>">X</a>
                  </span>
                </li>
                <li class="centro__li">
                  <svg class="centro__svg" viewBox="0 0 24 24">
                    <g>
                      <path
                        d="M14.046 2.242l-4.148-.01h-.002c-4.374 0-7.8 3.427-7.8 7.802 0 4.098 3.186 7.206 7.465 7.37v3.828c0 .108.044.286.12.403.142.225.384.347.632.347.138 0 .277-.038.402-.118.264-.168 6.473-4.14 8.088-5.506 1.902-1.61 3.04-3.97 3.043-6.312v-.017c-.006-4.367-3.43-7.787-7.8-7.788zm3.787 12.972c-1.134.96-4.862 3.405-6.772 4.643V16.67c0-.414-.335-.75-.75-.75h-.396c-3.66 0-6.318-2.476-6.318-5.886 0-3.534 2.768-6.302 6.3-6.302l4.147.01h.002c3.532 0 6.3 2.766 6.302 6.296-.003 1.91-.942 3.844-2.514 5.176z"
                      ></path>
                    </g>
                  </svg>
                  <span class="centro__numero">1</span>
                </li>
                <li class="centro__li">
                  <svg class="centro__svg" viewBox="0 0 24 24">
                    <g>
                      <path
                        d="M23.77 15.67c-.292-.293-.767-.293-1.06 0l-2.22 2.22V7.65c0-2.068-1.683-3.75-3.75-3.75h-5.85c-.414 0-.75.336-.75.75s.336.75.75.75h5.85c1.24 0 2.25 1.01 2.25 2.25v10.24l-2.22-2.22c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l3.5 3.5c.145.147.337.22.53.22s.383-.072.53-.22l3.5-3.5c.294-.292.294-.767 0-1.06zm-10.66 3.28H7.26c-1.24 0-2.25-1.01-2.25-2.25V6.46l2.22 2.22c.148.147.34.22.532.22s.384-.073.53-.22c.293-.293.293-.768 0-1.06l-3.5-3.5c-.293-.294-.768-.294-1.06 0l-3.5 3.5c-.294.292-.294.767 0 1.06s.767.293 1.06 0l2.22-2.22V16.7c0 2.068 1.683 3.75 3.75 3.75h5.85c.414 0 .75-.336.75-.75s-.337-.75-.75-.75z"
                      ></path>
                    </g>
                  </svg>
                  <span class="centro__numero">1</span>
                </li>
                <li class="centro__li">
                  <% if (loggedInUser.liked.some((like)=>
                  like._id.equals(tweet._id))) { %>
                  <a href="/like/<%= tweet._id %>">
                    <svg
                      class="centro__svg"
                      viewBox="0 0 24 24"
                      style="fill: red"
                    >
                      <g>
                        <path
                          d="M12 21.638h-.014C9.403 21.59 1.95 14.856 1.95 8.478c0-3.064 2.525-5.754 5.403-5.754 2.29 0 3.83 1.58 4.646 2.73.814-1.148 2.354-2.73 4.645-2.73 2.88 0 5.404 2.69 5.404 5.755 0 6.376-7.454 13.11-10.037 13.157H12zM7.354 4.225c-2.08 0-3.903 1.988-3.903 4.255 0 5.74 7.034 11.596 8.55 11.658 1.518-.062 8.55-5.917 8.55-11.658 0-2.267-1.823-4.255-3.903-4.255-2.528 0-3.94 2.936-3.952 2.965-.23.562-1.156.562-1.387 0-.014-.03-1.425-2.965-3.954-2.965z"
                        ></path>
                      </g></svg
                  ></a>
                  <% } else { %>
                  <a href="/like/<%= tweet._id %>">
                    <svg class="centro__svg" viewBox="0 0 24 24">
                      <g>
                        <path
                          d="M12 21.638h-.014C9.403 21.59 1.95 14.856 1.95 8.478c0-3.064 2.525-5.754 5.403-5.754 2.29 0 3.83 1.58 4.646 2.73.814-1.148 2.354-2.73 4.645-2.73 2.88 0 5.404 2.69 5.404 5.755 0 6.376-7.454 13.11-10.037 13.157H12zM7.354 4.225c-2.08 0-3.903 1.988-3.903 4.255 0 5.74 7.034 11.596 8.55 11.658 1.518-.062 8.55-5.917 8.55-11.658 0-2.267-1.823-4.255-3.903-4.255-2.528 0-3.94 2.936-3.952 2.965-.23.562-1.156.562-1.387 0-.014-.03-1.425-2.965-3.954-2.965z"
                        ></path>
                      </g></svg
                  ></a>
                  <% } %>

                  <span class="centro__numero">
                    <%= tweet.likes.length %>
                  </span>
                </li>
                <li class="centro__li">
                  <svg class="centro__svg" viewBox="0 0 24 24">
                    <g>
                      <path
                        d="M17.53 7.47l-5-5c-.293-.293-.768-.293-1.06 0l-5 5c-.294.293-.294.768 0 1.06s.767.294 1.06 0l3.72-3.72V15c0 .414.336.75.75.75s.75-.336.75-.75V4.81l3.72 3.72c.146.147.338.22.53.22s.384-.072.53-.22c.293-.293.293-.767 0-1.06z"
                      ></path>
                      <path
                        d="M19.708 21.944H4.292C3.028 21.944 2 20.916 2 19.652V14c0-.414.336-.75.75-.75s.75.336.75.75v5.652c0 .437.355.792.792.792h15.416c.437 0 .792-.355.792-.792V14c0-.414.336-.75.75-.75s.75.336.75.75v5.652c0 1.264-1.028 2.292-2.292 2.292z"
                      ></path>
                    </g>
                  </svg>
                </li>
              </ul>
            </div>
          </section>
          <% }) %>
        </div>
      </div>
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content" style="background-color: rgb(21, 32, 43)">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                Seguidos y seguidores
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="container">
                <div class="row">
                  <div class="col-md-6">
                    <h4 class="fw-bold fs-3" style="color: rgb(29, 161, 242)">
                      Seguidores
                    </h4>
                    <% user.followers.forEach((follower)=> { %>
                    <a class="my-2" href="/usuario/<%= follower.userName %>"
                      >@<%= follower.userName %></a
                    >
                    <% }) %>
                  </div>
                  <div class="col-md-6">
                    <h4 class="fw-bold fs-3" style="color: rgb(29, 161, 242)">
                      Seguidos
                    </h4>
                    <% user.following.forEach((followed)=> { %>
                    <a class="my-2" href="/usuario/<%= followed.userName %>"
                      >@<%= followed.userName %></a
                    >
                    <% }) %>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal -->
      <div
        class="modal fade"
        id="editProfileModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content bg-dark">
            <div class="modal-header bg-dark">
              <h5 class="modal-title" id="exampleModalLabel">Editar perfil</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body bg-dark">
              <form
                action="/usuario/editar"
                method="POST"
                enctype="multipart/form-data"
              >
                <div class="mb-3">
                  <label for="image" class="form-label">
                    Suba su imágen de perfil
                  </label>
                  <input
                    id="image"
                    type="file"
                    name="image"
                    class="form-control"
                  />
                </div>
                <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label"
                    >Nombre</label
                  >
                  <input
                    name="firstName"
                    type="text"
                    class="form-control"
                    id="exampleInputEmail1"
                    aria-describedby="emailHelp"
                    value="<%= user.firstName %> "
                  />
                </div>
                <div class="mb-3">
                  <label for="exampleInputPassword1" class="form-label"
                    >Apellido</label
                  >
                  <input
                    name="lastName"
                    type="text"
                    class="form-control"
                    id="exampleInputPassword1"
                    value="<%= user.lastName %> "
                  />
                </div>
                <div class="mb-3">
                  <label for="exampleInputPassword1" class="form-label"
                    >Bio</label
                  >
                  <textarea
                    name="bio"
                    id="exampleInputPassword1"
                    class="form-control"
                    cols="30"
                    rows="10"
                  >
<%= user.description %></textarea
                  >
                </div>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="btn btn-primary">Submit</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>

    <script>
      let result = window.location.search;
      if (result) {
        let alerta = result.slice(-18);
        alert(alerta.split("_").join(" "));
      }
    </script>
    <!--  <script>
        const errTitle = document.querySelector(".err-title");
      let message = Object.fromEntries([
        ...new URLSearchParams(location.search),
      ]);
      errTitle.innerText = message.error;
      </script> -->
  </body>
</html>
